<!DOCTYPE html>
<html>
<head>
    <!-- 解决语雀图片防盗链 -->
    <meta name="referrer" content="no-referrer" />
    

    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?d00f33bc9bb5ed02b143f502ceaefd41"></script>
<!-- End Baidu Tongji -->




    <meta charset="utf-8">
    
    
    
    
    <title>推荐工程架构方案调研 | 西土城马戏团 | Keep Listening Keep Thinking</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="推荐系统,架构设计">
    <meta name="description" content="调研背景和目的目前公司的推荐系统已经初步形成召回-精排-重排的架构，但在一些基础设施上还有诸多的不足，这次调研旨在借鉴外部公司优秀成熟的推荐工程架构方案，寻找当前最适合公司的系统设计方案，进一步优化工程链路。 闲鱼推荐系统调研淘系推荐系统多基于 BE、RTP 引擎实现业务的定制化，比较常见的如手淘首猜、手猫首猜等场景。而闲鱼推荐系统有一定的业务特殊性，由于是二手交易所以商品多为“孤品”，对实时性要">
<meta property="og:type" content="article">
<meta property="og:title" content="推荐工程架构方案调研">
<meta property="og:url" content="https://xiaoysec.github.io/2023/02/20/%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/index.html">
<meta property="og:site_name" content="西土城马戏团">
<meta property="og:description" content="调研背景和目的目前公司的推荐系统已经初步形成召回-精排-重排的架构，但在一些基础设施上还有诸多的不足，这次调研旨在借鉴外部公司优秀成熟的推荐工程架构方案，寻找当前最适合公司的系统设计方案，进一步优化工程链路。 闲鱼推荐系统调研淘系推荐系统多基于 BE、RTP 引擎实现业务的定制化，比较常见的如手淘首猜、手猫首猜等场景。而闲鱼推荐系统有一定的业务特殊性，由于是二手交易所以商品多为“孤品”，对实时性要">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676971426555-d50e6a0b-678a-406c-8731-3b8c0ed9ffaa.png#averageHue=%23dedcd9&clientId=uc32cba5f-e439-4&from=paste&height=339&id=ue676e677&name=image.png&originHeight=678&originWidth=1546&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=405359&status=done&style=none&taskId=u92eea493-6363-4f27-9ad7-0d9441face3&title=&width=773">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676974163699-7cc9dfcc-0fee-4bd9-8e12-53752368c7e4.png#averageHue=%23f9f9f9&clientId=uc32cba5f-e439-4&from=paste&height=397&id=u9965db63&name=image.png&originHeight=794&originWidth=1514&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=106980&status=done&style=none&taskId=uc5b8f3a2-a51a-418f-aa40-efcbc08255f&title=&width=757">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676974646225-fa49a9e1-1a02-4af4-bab2-9600937b24aa.png#averageHue=%23ede6de&clientId=uc32cba5f-e439-4&from=paste&height=498&id=uf5d01c84&name=image.png&originHeight=996&originWidth=1566&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=791296&status=done&style=none&taskId=udbcb0a1a-7235-406e-994a-6c86b0e1b87&title=&width=783">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676974660108-dc74eeca-8878-4575-8105-532b66cab58a.png#averageHue=%23f1eeea&clientId=uc32cba5f-e439-4&from=paste&height=294&id=uc6e564cc&name=image.png&originHeight=588&originWidth=1544&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=304654&status=done&style=none&taskId=uc8929b3c-2201-4db7-be36-16a57f9e964&title=&width=772">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676975360653-68d719e2-86ab-46a9-bdec-c7ae78c018f8.png#averageHue=%23f2ebe3&clientId=uc32cba5f-e439-4&from=paste&height=824&id=JBqXl&name=image.png&originHeight=1648&originWidth=1182&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=626934&status=done&style=none&taskId=u298cd5c4-67e5-4556-98b0-a4a18bf7b66&title=&width=591">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676976709098-899559a6-f184-4b0f-9865-01741e36e6ac.png#averageHue=%23f6f2e4&clientId=uc32cba5f-e439-4&from=paste&height=223&id=u5fcbdad7&name=image.png&originHeight=446&originWidth=1554&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=203046&status=done&style=none&taskId=uf2a7a8df-ec24-4188-96c8-99d78ca8249&title=&width=777">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676977009188-a62bcfa2-6767-402c-b6a2-b171aac0ca57.png#averageHue=%23fbfbfb&clientId=uc32cba5f-e439-4&from=paste&height=492&id=u769ec94d&name=image.png&originHeight=984&originWidth=1560&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=188217&status=done&style=none&taskId=u06221403-ddae-4882-a359-40518877eea&title=&width=780">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676977501168-b4030227-f339-48be-8830-8cea24cbdb8b.png#averageHue=%23fbfbfb&clientId=uc32cba5f-e439-4&from=paste&height=457&id=ubfb31554&name=image.png&originHeight=914&originWidth=1564&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=194459&status=done&style=none&taskId=uab07092c-056e-4f69-a5cf-b7fd533e6e5&title=&width=782">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677137882102-b5f5f635-9f76-41af-83db-bdfb2a629acc.png#averageHue=%23f0f0f0&clientId=u24224083-3cea-4&from=paste&height=365&id=u8b38f6f3&name=image.png&originHeight=730&originWidth=1568&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=396753&status=done&style=none&taskId=u415289ee-5c31-4224-9202-5d069080857&title=&width=784">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677140871141-ad8c706f-e0ab-4db5-873e-d3edc1426c27.png#averageHue=%23f6f0ef&clientId=u24224083-3cea-4&from=paste&height=384&id=u197f3c39&name=image.png&originHeight=768&originWidth=1544&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=333835&status=done&style=none&taskId=ue9705e72-030f-46aa-8e28-8f0a2a7f88f&title=&width=772">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677140955789-f49b90f6-b5e3-4fc5-b323-fb9512c66013.png#averageHue=%23f8f5f1&clientId=u24224083-3cea-4&from=paste&height=315&id=u8f155aef&name=image.png&originHeight=630&originWidth=1576&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=232494&status=done&style=none&taskId=u0e8df0ad-0a39-4f9d-a0c3-789929c94a9&title=&width=788">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677204445795-51af3f40-5f5d-4d0c-8d46-5614f29fd063.png#averageHue=%23fafaf9&clientId=u2b36575d-4cf6-4&from=paste&height=417&id=u3ee863d9&name=image.png&originHeight=834&originWidth=1010&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=178908&status=done&style=none&taskId=ue7f3fbdd-aa69-4430-b034-cf3bb1739be&title=&width=505">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677204426890-596abb92-229d-4595-bde3-9198a975719d.png#averageHue=%23b9c3b9&clientId=u2b36575d-4cf6-4&from=paste&height=481&id=u251b0b60&name=image.png&originHeight=962&originWidth=1070&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=226804&status=done&style=none&taskId=u7465b3cc-f4d9-4ce6-8d7a-e19f3b3a056&title=&width=535">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677205600820-eeb63dfc-ed1d-40b6-8922-b588ef0218d4.png#averageHue=%23ebc6af&clientId=u2b36575d-4cf6-4&from=paste&height=356&id=u4026ba70&name=image.png&originHeight=712&originWidth=1506&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=635654&status=done&style=none&taskId=ucf369f10-f69d-4500-83e7-5c251c8a519&title=&width=753">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677207021578-0c93c7ab-6cdf-4cd6-be7c-4812ac83a6da.png#averageHue=%238ed5ab&clientId=u2b36575d-4cf6-4&from=paste&height=537&id=ueb29af40&name=image.png&originHeight=1074&originWidth=1502&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=961126&status=done&style=none&taskId=ub9173e16-2838-4f7c-976e-9542cebc163&title=&width=751">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677208508113-1e237270-d418-49e7-8eb7-c67d19807260.png#averageHue=%23f7f7f4&clientId=u2b36575d-4cf6-4&from=paste&height=280&id=u5b89537c&name=image.png&originHeight=560&originWidth=1482&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=329469&status=done&style=none&taskId=u726a49aa-8d2c-4f48-9a6e-a0cd5948773&title=&width=741">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677208655439-23866788-eabe-400c-9db6-6b9a24816d25.png#averageHue=%23fbf9f8&clientId=u2b36575d-4cf6-4&from=paste&height=409&id=udf503a91&name=image.png&originHeight=818&originWidth=1568&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=574720&status=done&style=none&taskId=ud891e0da-8e4a-484b-b2b2-9a4e229936d&title=&width=784">
<meta property="article:published_time" content="2023-02-20T07:50:29.000Z">
<meta property="article:modified_time" content="2023-02-24T09:38:42.798Z">
<meta property="article:author" content="xiaoysec">
<meta property="article:tag" content="推荐系统">
<meta property="article:tag" content="架构设计">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676971426555-d50e6a0b-678a-406c-8731-3b8c0ed9ffaa.png#averageHue=%23dedcd9&clientId=uc32cba5f-e439-4&from=paste&height=339&id=ue676e677&name=image.png&originHeight=678&originWidth=1546&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=405359&status=done&style=none&taskId=u92eea493-6363-4f27-9ad7-0d9441face3&title=&width=773">
    
        <link rel="alternate" type="application/atom+xml" title="西土城马戏团" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="https://xiaoysec.github.io/about" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">xiaoysec</h5>
          <a href="mailto:xiaoysec@163.com" title="xiaoysec@163.com" class="mail">xiaoysec@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about" target="_blank" >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/xiaoysec" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">推荐工程架构方案调研</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">推荐工程架构方案调研</h1>
        <h5 class="subtitle">
            
                <time datetime="2023-02-20T07:50:29.000Z" itemprop="datePublished" class="page-time">
  2023-02-20
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/">推荐系统</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#调研背景和目的"><span class="post-toc-number">1.</span> <span class="post-toc-text">调研背景和目的</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#闲鱼推荐系统调研"><span class="post-toc-number">2.</span> <span class="post-toc-text">闲鱼推荐系统调研</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#整体架构"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">整体架构</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#圈品逻辑"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">圈品逻辑</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#召回引擎"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">召回引擎</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#算分引擎"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">算分引擎</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#贝壳推荐系统调研"><span class="post-toc-number">3.</span> <span class="post-toc-text">贝壳推荐系统调研</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#推荐系统演进过程"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">推荐系统演进过程</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#搜索推荐架构统一"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">搜索推荐架构统一</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#总结"><span class="post-toc-number">4.</span> <span class="post-toc-text">总结</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#现有架构"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">现有架构</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#主要问题"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">主要问题</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#参考文档"><span class="post-toc-number">5.</span> <span class="post-toc-text">参考文档</span></a></li></ol>
        </nav>
    </aside>


<article id="post-推荐工程架构方案调研"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">推荐工程架构方案调研</h1>
        <div class="post-meta">
            <time class="post-time" title="2023-02-20 15:50:29" datetime="2023-02-20T07:50:29.000Z"  itemprop="datePublished">2023-02-20</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/">推荐系统</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="调研背景和目的"><a href="#调研背景和目的" class="headerlink" title="调研背景和目的"></a>调研背景和目的</h3><p>目前公司的推荐系统已经初步形成召回-精排-重排的架构，但在一些基础设施上还有诸多的不足，这次调研旨在借鉴外部公司优秀成熟的推荐工程架构方案，寻找当前最适合公司的系统设计方案，进一步优化工程链路。</p>
<h3 id="闲鱼推荐系统调研"><a href="#闲鱼推荐系统调研" class="headerlink" title="闲鱼推荐系统调研"></a>闲鱼推荐系统调研</h3><p>淘系推荐系统多基于 BE、RTP 引擎实现业务的定制化，比较常见的如手淘首猜、手猫首猜等场景。而闲鱼推荐系统有一定的业务特殊性，由于是二手交易所以商品多为“孤品”，对实时性要求也相对较高。</p>
<h4 id="整体架构"><a href="#整体架构" class="headerlink" title="整体架构"></a>整体架构</h4><p>推荐系统流程和涉及模块如下图所示</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676971426555-d50e6a0b-678a-406c-8731-3b8c0ed9ffaa.png#averageHue=%23dedcd9&clientId=uc32cba5f-e439-4&from=paste&height=339&id=ue676e677&name=image.png&originHeight=678&originWidth=1546&originalType=binary∶=2&rotation=0&showTitle=false&size=405359&status=done&style=none&taskId=u92eea493-6363-4f27-9ad7-0d9441face3&title=&width=773" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>

<ol>
<li>用户信息： 通过用户 id 从用户中心服务获取用户的基本信息</li>
<li>Trigger: 一般为用户历史浏览、点击、互动行为的商品，或者用户的属性等。通过数据回流将 trigger 信息存储在在线系统，通过用户 ID 查询出来，参与后续的流程</li>
<li>召回: 基于用户的特征和 trigger 信息，从全量的亿级别候选集中，挑选出万级别的商品，送入后续的算分排序阶段</li>
<li>粗&#x2F;精排: 粗排一般使用简单网络结构如双塔，挑选千级别进精排。精排阶段会使用复杂模型</li>
<li>重排: 重排阶段，则会体现场景的业务诉求，做一下打散干预，比如类目打散、价格打散等</li>
<li>结果返回: 选取 topK 个商品，一般 10-20 个，填充商品信息后返回调用方</li>
<li>日志&amp;埋点: 对展示给用户的商品做端上日志</li>
</ol>
<p>在业务发展的过程中也存在电商推荐普遍存在的问题，如推荐场景的增加带来的迭代开发和维护成本增加，应对这种情况，通常需要工程团队抽象链路组件和模块，实现场景的配置化，下面展示了闲鱼推荐链路开发工作流。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676974163699-7cc9dfcc-0fee-4bd9-8e12-53752368c7e4.png#averageHue=%23f9f9f9&clientId=uc32cba5f-e439-4&from=paste&height=397&id=u9965db63&name=image.png&originHeight=794&originWidth=1514&originalType=binary∶=2&rotation=0&showTitle=false&size=106980&status=done&style=none&taskId=uc5b8f3a2-a51a-418f-aa40-efcbc08255f&title=&width=757" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>
<p>整个闲鱼的推荐平台如下图所示，大致上包含了 1. 底池圈品 2. 算法离线训练 3.引擎层(BE、RTP 之类) 4. 应用服务(类似 TPP 应用层) ，当然还会有其他外围系统如 AB 实验系统、KM 监控等等。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676974646225-fa49a9e1-1a02-4af4-bab2-9600937b24aa.png#averageHue=%23ede6de&clientId=uc32cba5f-e439-4&from=paste&height=498&id=uf5d01c84&name=image.png&originHeight=996&originWidth=1566&originalType=binary∶=2&rotation=0&showTitle=false&size=791296&status=done&style=none&taskId=udbcb0a1a-7235-406e-994a-6c86b0e1b87&title=&width=783" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>
<p>下图展示了用户请求后的完整链路<br>注： 对比下我们的链路，最大的区别是特征读取环节和 summary 环节以及重排阶段。在闲鱼的召回中充分利用到用户的实时行为，而我们的召回多以离线方式产出，在线召回阶段不需要复杂的用户特征了；另一方面 summary 这一步我们算法服务不涉及，由调用方(导购为主) 补全商品信息；重排阶段我们是放在了精排中作为一个模块，算法管理后台配置决定是否重排和重排的方式。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676974660108-dc74eeca-8878-4575-8105-532b66cab58a.png#averageHue=%23f1eeea&clientId=uc32cba5f-e439-4&from=paste&height=294&id=uc6e564cc&name=image.png&originHeight=588&originWidth=1544&originalType=binary∶=2&rotation=0&showTitle=false&size=304654&status=done&style=none&taskId=uc8929b3c-2201-4db7-be36-16a57f9e964&title=&width=772" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>

<h4 id="圈品逻辑"><a href="#圈品逻辑" class="headerlink" title="圈品逻辑"></a>圈品逻辑</h4><p>推荐候选池: 即圈品构建推荐底池，ETL 后在商品上打上场景标，圈品的逻辑在体量大一些的公司都存在，一方面是业务逻辑需要，另一方面是缩小推荐量级。下图展示了推荐候选池的构建过程，整体应该是基于 SARO 平台完成的。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676975360653-68d719e2-86ab-46a9-bdec-c7ae78c018f8.png#averageHue=%23f2ebe3&clientId=uc32cba5f-e439-4&from=paste&height=824&id=JBqXl&name=image.png&originHeight=1648&originWidth=1182&originalType=binary∶=2&rotation=0&showTitle=false&size=626934&status=done&style=none&taskId=u298cd5c4-67e5-4556-98b0-a4a18bf7b66&title=&width=591" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>

<h4 id="召回引擎"><a href="#召回引擎" class="headerlink" title="召回引擎"></a>召回引擎</h4><p>召回引擎: 提供了三种索引方式，分别是 i2i 索引，x2i 索引，深度召回，标准化输入与输出。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676976709098-899559a6-f184-4b0f-9865-01741e36e6ac.png#averageHue=%23f6f2e4&clientId=uc32cba5f-e439-4&from=paste&height=223&id=u5fcbdad7&name=image.png&originHeight=446&originWidth=1554&originalType=binary∶=2&rotation=0&showTitle=false&size=203046&status=done&style=none&taskId=uf2a7a8df-ec24-4188-96c8-99d78ca8249&title=&width=777" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>
<p>对于输入，第一种为 Trigger 格式，引擎将以传入的 Trigger 作为 key，从 i2i 与 x2i 索引中执行 KV 检索与倒排检索。第二种则是针对深度召回，上游传入模型预测出的 embedding 向量，再经由向量引擎完成检索。输出则是召回检索得到的商品 item_id 与对应的召回 recall_score。</p>
<ul>
<li>i2i 召回，通过用户的行为日志，计算商品间的用户共现得分，以此为相似度。以用户有过行为的商品 ID 为 TriggerKey 查询召回商品。</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676977009188-a62bcfa2-6767-402c-b6a2-b171aac0ca57.png#averageHue=%23fbfbfb&clientId=uc32cba5f-e439-4&from=paste&height=492&id=u769ec94d&name=image.png&originHeight=984&originWidth=1560&originalType=binary∶=2&rotation=0&showTitle=false&size=188217&status=done&style=none&taskId=u06221403-ddae-4882-a359-40518877eea&title=&width=780" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>

<ul>
<li>x2i: x 可以是商品的 tag、class、brand、query、pool_ids 等，根据用户全域的行为构建用户偏好，对商品标题信息进行分词，以及用户的 tag，class，品牌，搜索场景下对应 query 等，最终构建倒排索引进行检索</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1676977501168-b4030227-f339-48be-8830-8cea24cbdb8b.png#averageHue=%23fbfbfb&clientId=uc32cba5f-e439-4&from=paste&height=457&id=ubfb31554&name=image.png&originHeight=914&originWidth=1564&originalType=binary∶=2&rotation=0&showTitle=false&size=194459&status=done&style=none&taskId=uab07092c-056e-4f69-a5cf-b7fd533e6e5&title=&width=782" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>
<p>可以看到 i2i 和 x2i 召回在存储上有所不同，i2i 使用了 KKV 结构而 x2i 使用了倒排，应该是基于性能的考量，i2i 不需要复杂查询</p>
<ul>
<li>深度召回：主要通过深度网络模型，来预测用户与商品的相似性。模型分别计算出用户侧向量与商品侧向量，在线检索时，根据用户侧向量，通过向量引擎完成 ANN 检索出 topK 个商品。</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677137882102-b5f5f635-9f76-41af-83db-bdfb2a629acc.png#averageHue=%23f0f0f0&clientId=u24224083-3cea-4&from=paste&height=365&id=u8b38f6f3&name=image.png&originHeight=730&originWidth=1568&originalType=binary∶=2&rotation=0&showTitle=false&size=396753&status=done&style=none&taskId=u415289ee-5c31-4224-9202-5d069080857&title=&width=784" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>

<h4 id="算分引擎"><a href="#算分引擎" class="headerlink" title="算分引擎"></a>算分引擎</h4><p>算分引擎将输入的待打分候选商品集关联上商品特征，并结合用户的特征，通过深度网络模型的计算执行，完成候选商品集中每一个商品对该用户的个性化预测得分。将算分排序模型的输入输出进行标准化，也提供了模型定制化的能力。有些场景不太适应通用的多目标模型，可遵循协议将模型接入，每一个模型具备一个唯一的标识 biz_name，场景配置上选择该 biz_name 即可</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677140871141-ad8c706f-e0ab-4db5-873e-d3edc1426c27.png#averageHue=%23f6f0ef&clientId=u24224083-3cea-4&from=paste&height=384&id=u197f3c39&name=image.png&originHeight=768&originWidth=1544&originalType=binary∶=2&rotation=0&showTitle=false&size=333835&status=done&style=none&taskId=ue9705e72-030f-46aa-8e28-8f0a2a7f88f&title=&width=772" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>
<p>模型存在多个目标得分，比如 ctr_score、cvr_score、car_score 等。而最终的得分如何计算，场景内也支持配置运算表达式与加权&amp;降权（有些场景倾向转化，有些场景则重成交，或者满足交易抵扣的商品需要提权），来满足不同的场景要求。<br>注： 这种配置化权重的做法在我们精排服务中也支持(ESMM 模型)，只是整体上没有闲鱼做的这么标准化</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677140955789-f49b90f6-b5e3-4fc5-b323-fb9512c66013.png#averageHue=%23f8f5f1&clientId=u24224083-3cea-4&from=paste&height=315&id=u8f155aef&name=image.png&originHeight=630&originWidth=1576&originalType=binary∶=2&rotation=0&showTitle=false&size=232494&status=done&style=none&taskId=u0e8df0ad-0a39-4f9d-a0c3-789929c94a9&title=&width=788" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>

<h3 id="贝壳推荐系统调研"><a href="#贝壳推荐系统调研" class="headerlink" title="贝壳推荐系统调研"></a>贝壳推荐系统调研</h3><p>贝壳的文章中提到了推荐系统在贝壳的演进过程，同时讲到了搜索推荐架构融合的话题，比较有启发性。</p>
<h4 id="推荐系统演进过程"><a href="#推荐系统演进过程" class="headerlink" title="推荐系统演进过程"></a>推荐系统演进过程</h4><p>架构演进经历了四个大的迭代，最早期就是简单的基于内容和规则的推荐引擎，后面进一步增加了用户画像和协同过滤进行个性化推荐，再通过实时计算和实时模型实现实时个性化推荐，最后为了提升业务接入和迭代效率，推荐平台做了一个大的升级重构，支持业务配置化接入，最终升级为智能推荐平台。</p>
<ul>
<li>基于内容的推荐</li>
</ul>
<p>用 Content-based 推荐算法，直接离线算出相似房源、热门房源等，然后写入 Redis，在线推荐服务再从 Redis 中查出离线计算好的可能感兴趣的房源，然后直接返回给用户进行推荐</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677204445795-51af3f40-5f5d-4d0c-8d46-5614f29fd063.png#averageHue=%23fafaf9&clientId=u2b36575d-4cf6-4&from=paste&height=417&id=u3ee863d9&name=image.png&originHeight=834&originWidth=1010&originalType=binary∶=2&rotation=0&showTitle=false&size=178908&status=done&style=none&taskId=ue7f3fbdd-aa69-4430-b034-cf3bb1739be&title=&width=505" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>

<ul>
<li>实时个性化推荐</li>
</ul>
<p>在内容推荐的基础上，引入房源特征、实时用户画像和实时用户行为记录，升级为实时个性化推荐。个性化推荐底层新增经纪人作业数据、用户行为日志等数据，然后通过离线计算进行数据清洗和特征工程，生成房源特征和用户画像。再通过协同过滤算法，进行协同过滤推荐，然后把这些数据批量更新到在线存储引擎，包括离线计算好的召回数据、特征池和过滤集等，业务系统和推荐服务都会将实时埋点日志回流到实时计算服务和离线数仓中。从而实时更新召回数据和特征实现实时个性化推荐</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677204426890-596abb92-229d-4595-bde3-9198a975719d.png#averageHue=%23b9c3b9&clientId=u2b36575d-4cf6-4&from=paste&height=481&id=u251b0b60&name=image.png&originHeight=962&originWidth=1070&originalType=binary∶=2&rotation=0&showTitle=false&size=226804&status=done&style=none&taskId=u7465b3cc-f4d9-4ce6-8d7a-e19f3b3a056&title=&width=535" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>

<ul>
<li>智能平台推荐</li>
</ul>
<p>为了提升业务接入效率和效果迭代效率，不再每个业务场景对应一个独立的推荐服务，而是用同一套推荐服务支撑上层的所有业务，新接业务直接复用上线，而非重新开发启动一个服务。<br>将整个推荐服务做逻辑分层，分为应用层、计算层、数据层和模型层。应用层主要对外提供 API 接口，以及处理简单的业务规则和配置管理。计算层包含推荐的几个核心流程，如召回、融合、排序和过滤，会分别调用数据层和模型层。数据层统一对下层的在线存储系统进行基础的数据查询。模型层进行在线特征工程后会调用模型服务进行在线预测。计算层拿到数据层返回的结果后进行策略融合，然后调用模型层进行模型精排，最终返回给业务系统。<br>注：本质上也是接入层-召回层-排序层的抽象，和我们的做法基本上是一致的</p>
<h4 id="搜索推荐架构统一"><a href="#搜索推荐架构统一" class="headerlink" title="搜索推荐架构统一"></a>搜索推荐架构统一</h4><p>搜索和推荐有很多相通之处，在流程上基本非常相似，在数据和模型上有多可以复用，在外围平台工具层面也基本可以直接复用，不同之处主要是 Query，搜索围绕 Query 展开，而推荐没有明显的用户意图引导，以用户历史行为作为参考。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677205600820-eeb63dfc-ed1d-40b6-8922-b588ef0218d4.png#averageHue=%23ebc6af&clientId=u2b36575d-4cf6-4&from=paste&height=356&id=u4026ba70&name=image.png&originHeight=712&originWidth=1506&originalType=binary∶=2&rotation=0&showTitle=false&size=635654&status=done&style=none&taskId=ucf369f10-f69d-4500-83e7-5c251c8a519&title=&width=753" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>

<p>为什么要搜推架构统一: 核心是复用底层能力，避免重复建设带来的人力浪费和开发运维复杂性<br>架构统一方案架构图如下所示</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677207021578-0c93c7ab-6cdf-4cd6-be7c-4812ac83a6da.png#averageHue=%238ed5ab&clientId=u2b36575d-4cf6-4&from=paste&height=537&id=ueb29af40&name=image.png&originHeight=1074&originWidth=1502&originalType=binary∶=2&rotation=0&showTitle=false&size=961126&status=done&style=none&taskId=ub9173e16-2838-4f7c-976e-9542cebc163&title=&width=751" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>
<p>我们做的主要的大的重构是在查询层，对原搜索和推荐系统的各模块进行了统一的整合。<br>最新的查询层主要分为六个核心模块，请求一开始会通过中控模块做参数校验、策略调度、缓存和兜底，然后中控会去调用下层各模块，先是意图解析模块（搜索使用，推荐不需要），拿到意图解析的结果后再去调用召回模块，召回的时候会先获取一些用户画像和特征，然后进行多路召回和融合过滤，返回给中控，中控得到召回的数据后调用排序，排序包括粗排和精排，接下来是重排，再之后调用理由模块，补充推荐理由，比如“满五唯一”，“近地铁”等等。拿到理由之后就会最终反馈给业务方，完成整个搜索推荐调用的过程</p>
<ul>
<li>中控服务</li>
</ul>
<p>中控主要负责参数校验、调度、缓存、降级等功能，中控服务的设计原则是希望它尽量不要有业务逻辑，通过减少迭代最大化的保证中控服务的稳定性<br>注: 这一点有点类似阿里搜索用的 SP，但是贝壳的中控应该更“薄”，和我们召回引擎中的模块编排也是相同的思想，同时贝壳这个超时降级的方案也非常值得学习<br>最后中控最大的作用就是降级，任何下游服务超时或异常都不会造成业务方的查询异常，各个模块都有默认超时时间设置，但同时会实时计算剩余时间，各模块的实际超时时间是该模块默认超时时间和剩余时间的最小值。<br>比如一个常规的调用链，开始调用意图解析，再调用召回，再反馈给业务方。假设我们调完重排要调用理由的时候，发现理由服务挂掉或者响应超时，中控则会跳过理由模块直接返回，相当于是降级返回。如果召回模块超时，中控也会跳过召回模块，直接访问 ES 或 Redis，然后再拿这些结果去走后续的流程，相当于跳过整个召回逻辑直接拿基础引擎返回的召回数据传给排序走后面的流程。比如在异常情况下我们调重排的时候发现已经花了 950ms，由于只剩下 50ms，所以再去调理由的时候，理由模块的超时时间会被实时设置为 50ms，而忽略其默认的超时时间。</p>
<ul>
<li>召回服务</li>
</ul>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677208508113-1e237270-d418-49e7-8eb7-c67d19807260.png#averageHue=%23f7f7f4&clientId=u2b36575d-4cf6-4&from=paste&height=280&id=u5b89537c&name=image.png&originHeight=560&originWidth=1482&originalType=binary∶=2&rotation=0&showTitle=false&size=329469&status=done&style=none&taskId=u726a49aa-8d2c-4f48-9a6e-a0cd5948773&title=&width=741" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>

<ul>
<li>重排服务</li>
</ul>
<p>为了便利的组合复用这些规则逻辑，重排实现了 workflow 的工作流机制。例如默认配置中会有去重、融合、计算得分、按字段排序等默认规则，而“opt-in”可以增加规则，“opt-out”可以去除规则</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://cdn.nlark.com/yuque/0/2023/png/21378486/1677208655439-23866788-eabe-400c-9db6-6b9a24816d25.png#averageHue=%23fbf9f8&clientId=u2b36575d-4cf6-4&from=paste&height=409&id=udf503a91&name=image.png&originHeight=818&originWidth=1568&originalType=binary∶=2&rotation=0&showTitle=false&size=574720&status=done&style=none&taskId=ud891e0da-8e4a-484b-b2b2-9a4e229936d&title=&width=784" alt="image.png" title="">
                </div>
                <div class="image-caption">image.png</div>
            </figure>
<p>注：相对比较重，我们还是目前的重排还是多以策略打散为主，也有一些业务规则上的重排但是不太好做到标准化。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h4 id="现有架构"><a href="#现有架构" class="headerlink" title="现有架构"></a>现有架构</h4><p>以算法管理后台为中心，召回引擎、精排引擎作为底层基础设施，对外提供商品(内容)推荐、搜索排序、类目预测、个性化分发等服务。以推荐服务为例，目前我们也做到了召回-精排等主要服务的解耦，可以实现多场景动态化配置，使得新的推荐场景的接入成本进一步降低。</p>
<h4 id="主要问题"><a href="#主要问题" class="headerlink" title="主要问题"></a>主要问题</h4><p>当前的系统架构还存在许多不足和不合理的地方，最主要的有以下几点</p>
<ul>
<li>系统耦合</li>
</ul>
<p>业务初期算法底层支撑系统建设有所欠缺，导致部分业务系统需要自行完成召回、调用精排等操作，系统之间耦合程度比较高。独立出统一召回系统后，一定程度上降低了系统间的耦合性。但目前业务系统和算法服务系统之间仍有不少可改进之处，如业务系统通过场景 ID 获取精排配置后调用精排服务。理想情况下，业务系统只关心场景 ID，具体的召回、精排模型等配置对业务系统完全透明。</p>
<ul>
<li>特征管理</li>
</ul>
<p>当前针对每一个精排模型，算法同学需要手动维护多组特征，一方面增加了算法同学的工作量，另一方面也增加了存储的成本。而一些大公司普遍会自研特征平台，实现离在线特征的存储和用户、商品特征的管理，为召回引擎、搜索引擎、精排引擎等提供基础底层服务。</p>
<ul>
<li>实时性</li>
</ul>
<p>实时性主要体现在两方面，对用户行为的利用和商品元数据的增量更新。<br>在用户行为利用层面，以召回方式为例子，目前公司以离线召回为主，如双塔召回模型通过离线训练直接产出每个门店的召回结果，而更常见的做法是先在线通过模型计算用户维度向量再通过向量检索引擎获取召回物料；又如协同过滤召回中，目前我们会在离线阶段关联用户-商品行为表和商品-商品相关性表产出召回结果，而一些公司会通过在线方式获取用户一段时间内有过行为的商品作为 Trigger，再通过 Trigger 查询 i2i 表获取召回结果。上述两个例子都是将用户实时行为利用到召回中，对召回结果实时性有一定的作用。<br>在商品元数据更新层面，目前我们的链路中还不存在索引服务，也不存在增量消息更新。如发布端对商品基础信息做修改或商品售罄等情况，推荐侧是无法感知的，这对推荐结果的实时性有一定的影响。</p>
<ul>
<li>链路闭环</li>
</ul>
<p>一条完整的推荐链路涉及离线数据分析处理、样本采集、模型训练、索引构建、召回&amp;精排引擎部署、在线服务开发、埋点及端日志采集、AB 效果分析等。<br>埋点和日志采集涉及客户端配合，往往是比较容易出问题的一环，且一旦有问题也不容易被发现。目前我们分析实验效果需要关联离线报表（商品曝光+AB 平台日志，通过门店 ID 关联），因此如果对实验效果实时性有要求是无法满足的。一些公司会在服务端将实验信息添加到埋点中，客户端透传上报，这种方式更加灵活且避免了实验轮转带来的数据不准确问题，同时借助流计算可以做到实验的实时效果分析和业务指标的及时告警。</p>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p>[1] <a href="https://juejin.cn/post/7153878508035391502#heading-2" target="_blank" rel="noopener">详解闲鱼推荐系统（长文收藏） - 掘金</a><br>[2] <a href="https://developer.aliyun.com/article/543405" target="_blank" rel="noopener">BasicEngine — 基于 DII 平台的推荐召回引擎-阿里云开发者社区</a><br>[3] <a href="https://help.aliyun.com/document_detail/407616.html" target="_blank" rel="noopener">如何快速拉起多路召回服务_智能推荐 AIRec-阿里云帮助中心</a><br>[4] <a href="https://help.aliyun.com/document_detail/407620.html" target="_blank" rel="noopener">调用 BeRead 接口获取智能召回引擎的召回结果_智能推荐 AIRec-阿里云帮助中心</a><br>[5] <a href="https://www.infoq.cn/article/jb3_dhjgrcron174ucv6" target="_blank" rel="noopener">当你打开天猫的那一刻，推荐系统做了哪些工作？<em>AI</em>陈启伟_InfoQ 精选文章</a><br>[6] <a href="https://www.6aiq.com/article/1601333030483" target="_blank" rel="noopener">贝壳找房 | 降本提效，贝壳搜索推荐架构统一之路 - AIQ</a></p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2023-02-24T09:38:42.798Z" itemprop="dateUpdated">2023-02-24 17:38:42</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/2023/02/20/%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/" target="_blank" rel="external">https://xiaoysec.github.io/2023/02/20/%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/</a>
        
    </div>
    
    <footer>
        <a href="https://xiaoysec.github.io">
            <img src="/img/avatar.jpg" alt="xiaoysec">
            xiaoysec
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/" rel="tag">推荐系统</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/" rel="tag">架构设计</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://xiaoysec.github.io/2023/02/20/%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/&title=《推荐工程架构方案调研》 — 西土城马戏团&pic=https://xiaoysec.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://xiaoysec.github.io/2023/02/20/%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/&title=《推荐工程架构方案调研》 — 西土城马戏团&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://xiaoysec.github.io/2023/02/20/%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《推荐工程架构方案调研》 — 西土城马戏团&url=https://xiaoysec.github.io/2023/02/20/%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/&via=https://xiaoysec.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://xiaoysec.github.io/2023/02/20/%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2023/02/28/%E7%89%B9%E5%BE%81%E5%B9%B3%E5%8F%B0%E8%B0%83%E7%A0%94-%E7%BD%91%E6%98%93%E6%96%B0%E9%97%BB%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">特征平台调研-网易新闻推荐工程</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2023/02/20/%E8%AF%AD%E9%9B%80%E6%96%87%E7%AB%A0%E5%90%8C%E6%AD%A5Hexo/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">语雀文章同步Hexo</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "JV9OEqq8eybOt1zwnuJfUskP-9Nh9j0Va",
            appKey: "ZHH0fZUDA2mN08nH1JN6jua4",
            avatar: "mm",
            placeholder: "快来评论吧~",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->










</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>xiaoysec &copy; 2023</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://xiaoysec.github.io/2023/02/20/%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/&title=《推荐工程架构方案调研》 — 西土城马戏团&pic=https://xiaoysec.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://xiaoysec.github.io/2023/02/20/%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/&title=《推荐工程架构方案调研》 — 西土城马戏团&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://xiaoysec.github.io/2023/02/20/%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《推荐工程架构方案调研》 — 西土城马戏团&url=https://xiaoysec.github.io/2023/02/20/%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/&via=https://xiaoysec.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://xiaoysec.github.io/2023/02/20/%E6%8E%A8%E8%8D%90%E5%B7%A5%E7%A8%8B%E6%9E%B6%E6%9E%84%E6%96%B9%E6%A1%88%E8%B0%83%E7%A0%94/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASYAAAEmCAAAAADqr2IGAAAEgElEQVR42u3aS44bOwwFUO9/051pHoK47yXVDyXn1MhwO/qcCiCS4usVP1+/Pb9/8+df//b9n6O9/3xqJe9/f/jBhAkTJkyPZMqHnk2cjH9qltkvk7VhwoQJE6bbmdqJ82M+CQKS8CI5r5MRElBMmDBhwoQp2XB+AOcjJMl2vkJMmDBhwoSpPc6TsuymuDx7SW06jQkTJkyYPo+pHW5T5M1/UxRhy3F+sBaOCRMmTJgexjQroX7G5x/pb8KECRMmTI9h+iqf2Wht+TWfazNvsWtMmDBhwnQtU35AtteQZw/mdqvvy8TtfjFhwoQJ071Ms6P31PT7cGTWNtT+J8CECRMmTJ/ElEw2a+vZXJrmh/0maBjGI5gwYcKE6RKmFijfUr7VZD2b4vLsVWHChAkTpnuZ9lj5CG3hNYFuR9gk7ZgwYcKE6V6m2cHcbqNdYn60t3PN0nhMmDBhwnQvU1v6bAumedvNJoXOA502sMCECRMmTPcy5Q0xm3acTcCRv5JkxmHQgAkTJkyYrmVqU802mMgba06FFJsL0aglCBMmTJgwXcU028ysVDorBLcBQRt8RGvDhAkTJkwfwbRJemeXmu3xPysTz9Lpby4yMWHChAnTBzHll4htYfdUEtsm3vk1bREQYMKECROmRzLlF5mbS8Ek4GgT4P+nQFzEQZgwYcKE6ZFM+dG433xbUG7T1P0x/02RFxMmTJgwXciUpJGbwm6bPLebTFLxzVyvzdCYMGHChOmRTHlYMCuztkf75nr1bAkYEyZMmDDdyJQfqHlhd3bE/kTBt20bGia6mDBhwoTpEqa2pNs28WwCguTwnq0/alTChAkTJkwfytSWetsrybNzzXYRhS+YMGHChOlapjy93FwQtnyztLxd87CsjAkTJkyYrmVqt50UfJMDe1Y+zo/wfXEZEyZMmDDdzpQczLMmnnar7eZnpeH2ohQTJkyYMN3OlJRH883PUtY2KZ0VqXP612YITJgwYcL0GKbZ1WBbnM3bbk6VdE8VeTFhwoQJ0+1M7dD7mnFOPGvKyde2uu/FhAkTJkyXMH2NnmT65POscSff3qxMHFXBMWHChAnTVUx5EHAqjWyvGGdhyixoiCoEmDBhwoTpEqZTQ7Rl1jahTQKCfftRsRJMmDBhwnQJ0951lrK2qfU+IZ8FCpgwYcKE6ZOY8omjwmgZZGzag/LZh3vBhAkTJkyXM+XL2pdH2yBg02B0IBTAhAkTJkwfxDRLU9vkOf9mQzZ7AdGtLyZMmDBhuopp1jTTXijO2nfaDb9f1evsgwkTJkyYLmGaHflJSpwf5MnrmSXem26m//wVEyZMmDBdyzQ7E/PWn1mBeB9qtOPPmpYwYcKECdMtTPv2nXahecrdlqTbEjAmTJgwYfp3mPabnC163+hzNonFhAkTJkyY8gT1VFvPrMjbvpJv/hUmTJgwYfpnmHKgPCCYJcmzovAsMcaECRMmTLcznZogSYDbEGF2Ibpf57AWjgkTJkyYHsY0TAWDQd/Tb4rCyavN0/IVDSZMmDBhei7TL+3Rbb4mwN6EAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
